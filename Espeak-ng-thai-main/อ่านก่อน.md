# อีสะปี๊ต-เอนจี-ไทย(Espeak-ng-Thai)

เครื่องมือ สำหรับ แยก แปรรูป ข้อความภาษาไทย เป็น โค็ด ipa ใช้ป้อนเข้า espeak-ng ให้พูดภาษาไทยได้

คู่มือนี้ในภาษาอังกฤษ อยู่ในไฟล์ README.md

## คำแนะนำ

อีสะปี๊ต-เอนจี-ไทย (Espeak-ng-Thai) เป็น เครื่องมือคอมพิวเตอร์ สำหรับ แยก แปรรูป ข้อความภาษาไทย เป็น โค็ด ไอพีเอ (ipa) ใช้ป้อนเข้า โปรแกรม อีสะปี็ต espeak-ng ให้พูดภาษาไทยได้ เครื่องมือนี้สร้างขึ้นมาเพื่อใช้ในการค้นคว้าทดลองด้านภาษา อ่าน และ ฟัง ด้วยคอมพิวเตอร์ เวลานี้ยังเป็นเพียง ต้นแบบที่พอใช้งานได้ และยังพัฒนาอยู่

เครื่องมือนี้ สร้างขึ้นมาจาก โปรแกรมสาธารณะ ฟรีและเปิด (Free and open) หลายชุด และ ข้อมูลกับโปรแกรมที่เขียนเอง ฉะนั้นควรเผยแพร่เช่นเดียวกัน เพื่อส่งเสริมเป็นประโยชน์ในการค้นคว้าทดลองด้านภาษาไทยด้วยคอมพิวเตอร์และการสนทนาระหว่างคนไทยกับหุ่นยนตร์ไทยต่อไป ในทศวรรตนี้

เครื่องมือนี้ แบ่งงานเป็น ๒ ขั้นตอน การแยกแปรรูปข้อความเป็นคำและโค็ดเสียง (Graphene to Phoneme - G2P) และ การออกเสียง (voice synthesizing - speak)

การแยก แปรรูป ข้อความภาษาไทย เป็น คำ และ โค็ด (G2P) ยังเป็นปัญหายาก เพราะการเขียนกาษาไทย ไม่มี วรรค ตอน ระหว่าง คำ ระหว่าง วลี หรือ ประโยค มีการคิด ค้นหาวิธีต่างๆ ที่รายงานในวารสารวิชาการต่างๆ หลายวิธีก็ใช้งานได้ดี แต่ก็ยังปรับปรุงได้อีก เครื่องมือนี้ใช้กระบวนการเหมือนที่ เราเรียนอ่านภาษาไทย ครั้งเป็นเด็กประถม ตัวอย่างเช่น ก -ะ, ก -า, ก -า ง ้, ส เ-ือ ้, คือเรียนเป็น ตำ พยางค์เดียว หรือ เสียงเดียว ประกอบด้วย พยัญชนะต้น สระ พยัญชนะสะกด และ วรรณยุกต์ แล้ว ปรับเปลี่ยนตาม ข้อบังคับ และข้อยกเว้น ตามแบบ {ถ้า ---  ก็ ---} (if --- then ---)

จีทูพี (D2P) ในอีสะปี๊ต-เอนจี-ไทย (Espeak-ng-Thai) ใช้โปรแกรม SWATH หรือ THWBRK (ใน libthai package) (ดาวนโลด ได้จาก Linux Repository) ในการแยกข้อความภาษาไทย เป็น พยางค์ โดยใช้ คลังพยางค์ thbrk.tri ที่อยู่ในแฟ้ม th-utterdict แทน คลังคำ (dictionary) ที่เดิมให้มา

หลังการแยกข้อความ ก็อ่านและแปรรูปอักษรไทยในแต่ละพยางค์ เป็น โค็ด ไอพีเอ (ipa) ที่ใช้ป้อนเข้า โปรแกรม อีสะปี็ต espeak-ng ให้พูดออกมา (มีโปรแกรมพูด synthesizer อีกหลายโปรแกรม เช่น espeak, festival, mbrola, pico, svox ที่อาจจะใช้ สร้างไฟล์เสียง จาก โค็ดไอพีเอ แต่ว่า ระบบโค็ดไอพีเอ ไม่เหมือนกัน

หมายเหตุ  ในภาษาไทย สระ และ วรรณยุกต์ อาจจะไม่ปรากฏในตัวเขียน พยางค์ในตัวเขียน (syllable) หลายแบบ อาจจะ อ่านออกเสียงเป็น พยางค์เสียง (utter) เดียวกัน เช่น กาน การ การณ์ กำ กัม กม-ลา และ พยางค์ในตัวเขียน อาจจะไม่มีสระ เช่น สระ ผล กร หรีอ ใช้รูปสระ หลายแบบต่างจากธรรมดา เช่น เกิน เกลอ ก็ เกาะ นอกจากนี้ พยัญชนะต้น มีเสียงสูง-กลาง-ต่ำ โดยเฉพาะตัว ส่งผลบังคับเสียงเหนือวรรณยุกต์ พยัญชนะสะกด ก็มี ตัวเป็น และคัวตาย ส่งผลบังคับเสียงเหนือวรรณยุกต์อีกด้วย

## การก่อสร้างเครื่องมือ

อีสะปี๊ต-เอนจี-ไทย (Espeak-ng-Thai) นี้เริ่มพัฒนาบนคอมพิวเตอร์ระบบ Ubuntu 16.4LTS และต่อมาบน Linux Mint 20.1LTS วิธีการสร้างที่อยู่ข้างล่าง อาจจะใช้ไม่ได้กับคอมพิวเตอร์ระบบอื่น

ขอขอบคุณ ผู้พัฒนาและดูแล โปรแกรมและข้อมูลสาธารณะ ฟรีและเปิด (Free and open) ชุดต่างๆที่ใช้และช่วยให้ สามารถพัฒนาเครื่องมือนี้ขึ้นมาได้

### คลังพยางค์ Utterdict

คลังพยางค์ thbrk.tri ที่อยู่ในแฟ้ม th-utterdict สร้างจาก พจนานุกรมไทยราชบัณฑิตยสถาน พศ ๒๕๔๒ สร้างด้วยโปรแกรมใน libdatrie (see http://linux.thai.net/~thep/datrie/datrie.html)

พยางค์ในคลังนี้ปรับเปลี่ยนได้ด้วยโปรแกรม trietool ใน libdatrie/tool

### การแยกและแปรรูป ข้อความภาษาไทย

จะใช้โปรแกรม SWATH หรือ TEST-THWBRK ก็ได้ในการแยกข้อความภาษาไทย เป็น พยางค์

โปรแกรม SWATH ติดตั้งได้จาก Linux repositories หรือดาวนโลดโค็ด(source code) มาคอมไพล์เองได้
{..$ sudo apt-get install swath}
แต่ในงานนี้ต้องใช้ คลังพยางค์ thbrk.tri แทนของเดิม data/swathdic.tri
ตัวอย่าง
{ echo "สวัสดีค่ะ" | swath -u u,u -d (path-to)/th-utterdict/thbrk.tri }
จะให้ผล
{ สวัส|ดี|ค่ะ }

โปรแกรม TEST-THWBRK สร้างจากไฟล์ test_thwbrk.c ที่ดัดแปลงสำหรับงานนี้ โปรแกรมนี้เรียก โปรแกรม THWBRK และ THBRK ใน libthai
ติดตั้ง libthai ได้จาก Linux repositories หรือดาวนโลดโค็ด(source code) มาคอมไพล์เองได้
{..$ sudo apt-get install libthai}
แล้วคอมไพล์ test_thwbrk.c ใหม่
เวลาใช้ test_thwbrk ต้องใช้ คลังพยางค์ thbrk.tri แทนของเดิม
ตัวอย่าง
{ LIBTHAI_DICTDIR=(path-to)/th-utterdict (path-to-modified)/tests/test_thwbrk -i "สวัสดีครับ" }
จะให้ผล
{ สวัส|ดี|ครับ }

ฆมายเหตุ เราไท่จำเป็นต้อง สร้าง-ติดตั้ง (make install) แค่ make ก็เพียงพอในการทดลอง แต่เวลาใช้ต้องบ่งบอก ที่อยู่ให้ชัดเจน

### Espeak-ng

อีสะปี๊ต-เอนจี (Espeak-ng) ดาวนโลดได้จาก https://github.com/espeak-ng/ ต้องดัดแปลง บางส่วนเพื่อใจ้พูดภาษาไทย

Espeak-ng รุ่น 1.5 (Jan 2021) รวมความสามารถพูดภาษาไทยไว้ด้วย แต่ว่า กำหนดให้ ภาษาไทย เป็นส่วนหนื่ง(subset)ของ ภาษาไทยใหญ่ (Shan language) ที่ถูกต้องกว่าคือ ภาษาไทยใหญ่ เป็นส่วนหนื่ง(subset)ของ ภาษาไทย (เพราะ ภาษาไทย มีอักษร ทากกว่า มัสระมากกว่า ภาษาไทย มีการกำหนดเสียงวรรณยุกต์ชัดเจนกว่า) คาดได้ว่า ไฟล์เสียงไทย ph_thai ใช้เป็น แม่แบบ สำหรับภาษาท้องถิ่นอื่นๆ ของไทยและลาวได้ แต่ไฟล์เสียงไทยใหญ่ ph_shan ใช้ใม่ได้

## อีสะปี๊ต-เอนจี-ไทย ไฟล์และโค๊ดช่วยงาน

โปรดอ่าน espeak-ng's ../docs/add_languages.md ก่อนเริ่มการดัดแปลง และอ่าน Espeak-ng's README.md ก่อนคอมไพล์ (make) อีสะปี๊ต-เอนจีที่พูดไทยได้ โปรดตรวจสอบด้วย
{ ./autogen.sh
  ./configure }
ว่าต้องใช้โปรแกรมอะไรอีก

### การดัดแปลง Espeak-ng

- เติมใส่ใน _Makefile.am_ file (สำหรับ 'make') ดังนี้

section _phsource/phonemes.stamp:_ **phsource/ph_thai** \

section _dictionaries:_ **espeak-ng-data/th_dict** \

แล้วเติมใน _th:_ section
{ th: espeak-ng-data/th_dict espeak-ng-data/th_dict: dictsource/th_list dictsource/th_rules dictsource/th_extra }

- กำหนดภาษาใน ../espeak-ng-data/lang/
{ ./tai
  ../th }
**Espeak-ng รุ่น 1.5 (Jan 2021) กำหนดความสามารถพูดภาษาไทยไว้แล้ว**

- ก๊อปปี้ไฟล์เหล่านี้ใส่ในแฟ๊ม ../dictsource/
{ - th_rules
  - th_list
  - th_extra
}
*หมายเหตุ*. ไฟล์ th_list และ th_extra ใม่มีอะไร (empty files)  ไฟล์ th_rules ถ้ามีอยู่ใช้ไม่ได้ ต้องใช้ไฟล์ที่ให้มาใหม่

- ก๊อปปี้ไฟล์นี้ใส่ในแฟ๊ม ../phsource/
{ ph_thai }

- แก้หรีอเติมเข้าไปในไฟล์ ../phsource/phonemes
{ phonemetable th base1
  include ph_thai }

จำเป็นต้องแก้ไชแต่งเติม espeak-ng เพียงเท่านี้ ก่อนคอมไพล์ใหม่ (./autogen.sh, ./configure, make, make test, ...) ถ้ามีปัญหา ใช้ 'make clean' แก้ปัญหา แล้ว make ใหม่

*หมายเหตุ* ถ้ามีการแก้ไขดัดแปลงไฟล์เสียง ph_thai ใช้ 'make th' คอมไพล์ใหม่ได้

### Gawk

โปรแกรม ==g2p.awk== ที่ใช้สำหรับแยกและแปรรูป ข้อความภาษาไทย เป็น โค็ด ipa เขียนในภาษาก๊อค The Gnu awk (gawk) script

โปรดอ่าน https://www.gnu.org/s/gawk/manual/html_node/Quick-Installation.html ก่อนติดตั้ง 'gawk' ในคอมพิวเตอร์

### g2p.awk

g2p.awk คือ โปรแกรม ที่ใช้สำหรับแยกและแปรรูป ข้อความภาษาไทย เป็น โค็ด ipa เขียนในภาษาก๊อค

### g2p-th2ipa.dat

ไฟล์ g2p-th2ipa.dat เป็น ตารางจับคู่ อักษรและเสียง(grapheme-to-phoneme translation table) ที่ใช้ใน g2p.awk จะแก้ไขหรือใช้ตารางอื่น ก็ได้

**หมายเหตุ.** ในตารางนี้ อักษรไทย จับคู่กับ เสียง ตามโค๊ดของEspeak-ng เพราะใขั Espeak-ng เป็นปากพูด

### espeak-th

โปรแกรม 'espeak-th' เขียนในภาษาแบ๊ช (Bash) รวมกระบวน g2p และ synthesizer ใช้สำหรับทดลองอ่านภาษาไทย เรียกใช้ได้หลายอย่าง เช่น

{ $ espeak-th -i"สวัสดีค่ะ" }
จะแสดงผล
{ # สวัส|ดี|ค่ะ s,aw'a1=d|d'ii0=|kh'a1=|:||
  # done : 3 syllables from 1 lines in -
}
หรือ
{ $ (path-to)/speak-th -f file-containing-thai-text }

มีไฟล์ .tmp หลายไฟล์: espeak-th-inf.tmp, espeak-th-auf.au, espeak-th-brk.tmp, and espeak-th-ipa.tmp ที่ใช้และเก็บไว้ให้ ตรวจสอบแก้ไขการทำงานของ espeak-th ได้

## More To Do

- ปรับปรุง เสียงพูด โดยการดัดแปลง ph_thai หรือใช้ MBROLA หรือ PRATT
- หาทางใส่ 'g2p' ภาษาไทย เข้าใน espeak-ng
- ปรับปรุง utterdict และเพิ่มเติม คำไทยใหม่ 'modern Thai'

## License

'espeak-ืng-thai' is copyrighted by its authors and licensed under terms of the GNU General Public License - see file COPYING for details.

'espeak-ng', 'libthai', 'libdatrie', 'GNU awk' 'swath' are also copyrighted by its authors and licensed under terms of the GNU General Public License - see file COPYING for details.

## Summary

อีสะปี๊ต-เอนจี-ไทย(Espeak-ng-Thai)นี้เป็น เครื่องมือชุดหนึ่ง ที่สร้างขึ้นเพื่อเป็นตัวอย่างของ การใช้คอมพิวเตอร์อ่านภาษาไทย (an example of pattern-matching-based Thai tts model) โดยใช้ โปรแกรมสาธารณะ ฟรีและเปิด (Free and open) หลายชุด มาช่วยงาน และจัดการด้วย espeak-th (bash script) เครื่องมือนี้ทดลองใช้บน Ubuntu 16.04LTS and Linux Mint 20.1 แล้วได้ผลน่าพอไจ

## Epilogue

จึงหวังว่า เครื่องมือนี้มีประโยชน์ ในการพัฒนาการอ่านภาษาไทย และ ภาษาท้องถิ่นในประเทศไทย รวมทั้ง ภาษาลาว และ ภาษาบาลี ด้วยคอมพิวเตอร์

มีข้อสงสัย ถามได้ แต่ ฉัน'เกษียณแล้ว'และอยู่ในเขตกันดารที่บริการสื่อสารโทรคมนาคมค่อนขาดแคลน หลายอย่างเป็นไปอย่างช้าๆ ฉะนั้นต้องใจเย็นคอยคำตอบหน่อย

sr12zar@gmail.com
